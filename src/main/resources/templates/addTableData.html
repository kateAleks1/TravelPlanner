<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Регистрация</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        form {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        button {

            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .error {
            color: red;
            margin: 10px 0;
        }
        .MainDivBlock{
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #Token {
            display: block;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-width: 500px;
            border: 1px solid #ccc;
            padding: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px; /
        text-align: left;
        }
        th {
            background-color: lightgray;
        }
        .BtnBlock{
            margin-top: 20px;
        }
    </style>
</head>

<body>
<h1>Create New Trip</h1>

<form id="Create Trip">
    <div class="MainDivBlock">
        <div class="LeftyBlock">
            <label for="startDate">StartDate:</label>
            <input type="datetime-local" id="startDate" name="startDate" required />

            <label for="endDate">EndDate:</label>
            <input type="datetime-local" id="endDate" name="endDate" required />

            <label for="status_id">status_id:</label>
            <select id="status_id" required>
                <option>1</option>
                <option>2</option>
                <option>3</option>
            </select>
<div class="BtnBlock">
    <button type="submit" id="createBtn">Create</button>
    <button type="submit" id="loginBtn">Login</button>
    <button type="button" id="registerBtn">Register</button>
</div>

        </div>
        <div class="RightBlock">
            <h1 >UserName</h1>
            <label id="userName">no login</label>
            <h1 >Token</h1>
            <label id="Token">Token</label>
            <h1 >UserId</h1>
            <label id="UserId">UserId</label>

        </div>
        <div class="StatusTrip">
            <table class="StatusTripTable">
                <thead>
                <tr class="stringLine">
                    <th>Status_id</th>
                    <th>status_name</th>
                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>



</form>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        getLogin();
        loadStatusTable();
    });
    document.getElementById('loginBtn').addEventListener('click',function () {
        window.location.href='login.html';
    })
    document.getElementById('registerBtn').addEventListener('click',function () {
        window.location.href='register.html';
    })
    function loadStatusTable(){
        const statusTable=document.getElementsByClassName('StatusTripTable')[0].querySelector('tbody');
        fetch('http://localhost:8080/api/trip_status/getStatusTrip',{
            method:'GET',
            headers:{
                'Content-Type':'application/json'
            }
        }).then(response=>{
            if(!response.ok){
                window.alert('Error')
            }
            return response.json();
        }).then(data=>{

            data.forEach(statusTrip=>{
                const tr=document.createElement('tr');
                tr.innerHTML=`
<td>${statusTrip.statusId}</td>
<td>${statusTrip.statusName}</td>
`;
                statusTable.appendChild(tr)
            })

        })
    }

    document.getElementById('createBtn').addEventListener("click", function (event) {
        event.preventDefault();
        const token = localStorage.getItem('AccessToken');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const status_id = parseInt(document.getElementById('status_id').value, 10);
        const users = localStorage.getItem('id');

        if (!startDateInput || !endDateInput) {
            console.error("StartDate or EndDate input is missing.");
            return;
        }

        const start_date = formatDate(startDateInput.value);
        const end_date = formatDate(endDateInput.value);

        const data = {
            trip_id: 2,
            start_date: start_date,
            end_date: end_date,
            status_id: status_id,
            price:100,
            idDestination: 1,
            users: users
        };

        fetch('http://localhost:8080/api/trip/createNewTrip', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
                window.location.href = 'tables.html';
            })
            .catch(error => console.error('Error:', error));
    });

    function formatDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}:00`;
    }


function  getLogin(){
    const  userName= document.getElementById('userName');

    const AccessToken=document.getElementById('Token');
 const token=localStorage.getItem('AccessToken');
 const userId=document.getElementById('UserId');
 fetch('http://localhost:8080/api/getLogin',{
     method:'POST',
     headers:{
         'Authorization': `Bearer ${token}`,
         'Content-Type': 'application/json'
     }

 }).then(response=>{
     return response.json();
 }).then(data=>{

     userName.innerHTML=data.login;
     userId.innerHTML=data.id;
     AccessToken.innerText=token;
     if(data.id){
         localStorage.setItem('id', data.id);
     }

 })
}

</script>

</body>
</html>
